{"version":3,"sources":["kratosr.js"],"names":["kr","window","requestIdleCallback","handler","startTime","Date","now","setTimeout","didTimeout","timeRemaining","Math","max","cancelIdleCallback","id","clearTimeout","xControl","$","document","on","event","this","next","slideToggle","parent","hasClass","removeClass","addClass","preventDefault","donateConfig","layer","open","type","area","title","donateBtn","resize","scrollbar","content","scanNotice","qr_alipay","qr_wechat","click","attr","fancyboxInit","fancybox","defaults","hash","each","i","find","is","alt","after","wrap","src","tocNavInit","animate","scrollTop","decodeURI","offset","top","copyrightString","docTitle","getTimeString","msec","exact","tString","sec","dnum","floor","hnum","mnum","snum","dstr","toString","hstr","mstr","sstr","length","makeDelay","callback","ms","timer","context","args","arguments","apply","pjaxReload","imageboxs","getElementsByClassName","prefix","siteRoot","picCDN","pic","CDN","randomAmount","parseInt","random_amount","picFileNameTemplate","filename","includes","usedPics","Array","generateNewPicID","picNo","remailFailCounts","random","len","picFileName","replace","setrandpic","copyrightNotice","querySelector","getAttribute","location","href","MathJax","Hub","Typeset","querySelectorAll","forEach","figure","count","getElementsByTagName","setAttribute","innerHTML","ClipboardJS","e","origInner","trigger","clearSelection","runningOnBrowser","isBot","navigator","test","userAgent","supportsIntersectionObserver","commsArea","loadwork","loadCommentsEventHandler","load_comm","observer","IntersectionObserver","entries","isIntersecting","disconnect","threshold","observe","commentsLazyLoad","expire_day","expireAlert","getElementById","dateTimeTag","updateDateTime","gap","innerText","classList","remove","expireNotify","tocDOMs","tocItems","from","tocItem","linkItem","titleText","substring","Error","titleElem","push","at","el","console","log","message","add","curTocId","tocActivate","newId","nCur","contains","parentNode","applyDecision","pos","scrollY","requestAnimationFrame","decision","entry","currentIndex","Number","target","boundingClientRect","rootBounds","bottom","height","intersectionRatio","rootMargin","x","addEventListener","once","tocUpdatePos","h","getBoundingClientRect","tocGetId","newPos","isInteger","nowY","tocOnScroll","tocOnResize","removeEventListener","readProgBar","articleElem","setPercent","currentTop","documentElement","docHeight","clientHeight","winHeight","headerHeight","offsetTop","contentMath","scrollHeight","scrollPercent","min","scrollPercentRound","round","style","width","tocAnimInit","funcUsingConfig","body","oncopy","copiedContent","getSelection","clipboardData","setData","siteLeaveEvent","titleTime","OriginLogo","hidden","leaveTitle","leaveLogo","returnTitle","leaveEventInit","createTime","upTimeNode","setInterval","initTime","topNavScrollToggle","lastHeight","innerHeight","isTopNavHidden","topNavScrollToggleInit","cb","fetch","then","res","json","cfg","isScrolledDown","pageScrollDownClass","pageScrollDownInit","$clone","clone","filter","class","prepend","css","w","offcanvas","container","has","fadeToggle","onload","dispatchEvent","Event","performance"],"mappings":"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","file":"../js/kratosr.min.js","sourcesContent":["let kr = {};\r\n\r\n/**\r\n * 因为后台任务API还是相当新的，而你的代码可能需要在那些仍不支持此API的浏览器上运行。\r\n * 你可以把 setTimeout() 用作回调选项来做这样的事。\r\n * 这个并不是 polyfill ，因为它在功能上并不相同； \r\n * setTimeout() 并不会让你利用空闲时段，而是使你的代码在情况允许时执行你的代码，\r\n * 以使我们可以尽可能地避免造成用户体验性能表现延迟的后果。\r\n */\r\n// https://developer.mozilla.org/zh-CN/docs/Web/API/Background_Tasks_API \r\nwindow.requestIdleCallback = window.requestIdleCallback || function(handler) {\r\n    let startTime = Date.now();\r\n    return setTimeout(function() {\r\n      handler({\r\n        didTimeout: false,\r\n        timeRemaining: function() {\r\n          return Math.max(0, 50.0 - (Date.now() - startTime));\r\n        }\r\n      });\r\n    }, 1);\r\n};\r\n\r\nwindow.cancelIdleCallback = window.cancelIdleCallback || function(id) {\r\n    clearTimeout(id);\r\n};\r\n\r\n(()=>{\r\n    const loadConfig = (cb) => {\r\n        // 读取配置文件\r\n        fetch((window.kr?.siteRoot || '/') + 'config/main.json')\r\n            .then((res) => {\r\n                return res.json();\r\n            })\r\n            .then((cfg) => {\r\n                kr = cfg;\r\n            })\r\n            .then(()=>{\r\n                cb();\r\n            });\r\n    };\r\n    const pageScrollDownInit = ()=>{\r\n        let isScrolledDown = false;\r\n        const pageScrollDownClass = () => {\r\n            window.requestAnimationFrame(() => {\r\n                if (window.scrollY > 200){\r\n                    if (!isScrolledDown) {\r\n                        document.body.classList.add('scroll-down');\r\n                        isScrolledDown = true;\r\n                    }\r\n                } else {\r\n                    if (isScrolledDown) {\r\n                        document.body.classList.remove('scroll-down');\r\n                        isScrolledDown = false;\r\n                    }\r\n                }\r\n            });\r\n        };\r\n        $('.gotop-box').on('click',function(event){\r\n            // event.preventDefault();\r\n            $('html, body').animate({\r\n                scrollTop:$('html').offset().top\r\n            },500);\r\n            return false;\r\n        });\r\n        pageScrollDownClass();\r\n        window.addEventListener('scroll', pageScrollDownClass);\r\n    };\r\n    const offcanvas = ()=>{\r\n        let $clone = $('#kratos-menu-wrap').clone();\r\n        $clone.attr({\r\n            'id':'offcanvas-menu'\r\n        });\r\n        $clone.filter('> ul').attr({\r\n            'class':'ul-me',\r\n            'id':''\r\n        });\r\n        $('#kratos-page').prepend($clone);\r\n        $('.js-kratos-nav-toggle').on('click',()=>{\r\n            if($('.nav-toggle').hasClass('toon')){\r\n                $('.nav-toggle').removeClass('toon');\r\n                $('#offcanvas-menu').css('right','-240px');\r\n            }else{\r\n                $('.nav-toggle').addClass('toon');\r\n                $('#offcanvas-menu').css('right','0px');\r\n            }\r\n        });\r\n        $('#offcanvas-menu').css('height',$(window).height());\r\n        $('#offcanvas-menu').css('right','-240px');\r\n        $(window).resize(()=>{\r\n            const w = $(window);\r\n            $('#offcanvas-menu').css('height',w.height());\r\n            if(w.width()>769){\r\n                if($('.nav-toggle').hasClass('toon')){\r\n                    $('.nav-toggle').removeClass('toon');\r\n                    $('#offcanvas-menu').css('right','-240px');\r\n                }\r\n            }\r\n        });\r\n    };\r\n    const mobiClick = ()=>{\r\n        $(document).click((e)=>{\r\n            const container = $(\"#offcanvas-menu,.js-kratos-nav-toggle\");\r\n            if (!container.is(e.target) && container.has(e.target).length === 0) {\r\n                if ($('.nav-toggle').hasClass('toon')) {\r\n                    $('.nav-toggle').removeClass('toon');\r\n                    $('#offcanvas-menu').css('right','-240px');\r\n                }\r\n            }\r\n        });\r\n    };\r\n    const xControl = ()=>{\r\n        $(document).on(\"click\",\".xHeading\", function(event){\r\n            $(this).next().slideToggle(300);\r\n            if ($(this).parent('.xControl').hasClass('active')) {\r\n                $(this).parent('.xControl').removeClass('active');\r\n            } else {\r\n                $(this).parent('.xControl').addClass('active');\r\n            }\r\n            event.preventDefault();\r\n        });\r\n    };\r\n\r\n    const donateConfig = ()=>{\r\n        $(document).on(\"click\",\".donate\",()=>{\r\n            layer.open({\r\n                type:1,\r\n                area:['300px', '370px'],\r\n                title:kr.donateBtn,\r\n                resize:false,\r\n                scrollbar:false,\r\n                content:'<div class=\"donate-box\"><div class=\"meta-pay text-center\"><strong>'+kr.scanNotice+'</strong></div><div class=\"qr-pay text-center\"><img class=\"pay-img\" id=\"alipay_qr\" src=\"'+kr.qr_alipay+'\"><img class=\"pay-img d-none\" id=\"wechat_qr\" src=\"'+kr.qr_wechat+'\"></div><div class=\"choose-pay text-center mt-2\"><input id=\"alipay\" type=\"radio\" name=\"pay-method\" checked><label for=\"alipay\" class=\"pay-button\"><img src=\"/images/alipay.webp\"></label><input id=\"wechatpay\" type=\"radio\" name=\"pay-method\"><label for=\"wechatpay\" class=\"pay-button\"><img src=\"/images/wechat.webp\"></label></div></div>'\r\n            });\r\n            $(\".choose-pay input[type='radio']\").click(function(){\r\n                const id = $(this).attr(\"id\");\r\n                if (id == 'alipay') {\r\n                    $(\".qr-pay #alipay_qr\").removeClass('d-none');\r\n                    $(\".qr-pay #wechat_qr\").addClass('d-none');\r\n                }\r\n                if (id == 'wechatpay') {\r\n                    $(\".qr-pay #alipay_qr\").addClass('d-none');\r\n                    $(\".qr-pay #wechat_qr\").removeClass('d-none');\r\n                }\r\n            });\r\n        });\r\n    };\r\n\r\n    const shareMenu = ()=>{\r\n        $(document).on(\"click\",\".share\",()=>{$(\".share-wrap\").fadeToggle(\"slow\");});\r\n    };\r\n\r\n    const setrandpic = ()=>{\r\n        // 图片\r\n        const imageboxs = document.getElementsByClassName(\"kratos-entry-thumb-new-img\");\r\n        let prefix = window.kr?.siteRoot || '/';\r\n        const picCDN = kr.picCDN ?? kr.pic?.CDN;\r\n        if (picCDN) {\r\n            switch (picCDN) {\r\n                case 'unpkg':\r\n                    prefix = \"//unpkg.com/hexo-theme-kratos-rebirth@latest/source/\";\r\n                    break;\r\n                case 'jsdelivr':\r\n                default:\r\n                    prefix = \"//cdn.jsdelivr.net/npm/hexo-theme-kratos-rebirth@latest/source/\";\r\n                    break;\r\n            }\r\n        }\r\n        const randomAmount = parseInt(kr.pic?.random_amount) || 20;\r\n        let picFileNameTemplate = \"images/thumb/thumb_{no}.webp\";\r\n        if (kr.pic && kr.pic.filename) {\r\n            if (kr.pic.filename.includes('//')) {\r\n                // 是绝对路径，那么忽略 CDN 选项\r\n                picFileNameTemplate = kr.pic.filename;\r\n            } else {\r\n                // 是相对主题根目录的路径\r\n                picFileNameTemplate = prefix + kr.pic.filename;\r\n            }\r\n        }\r\n        const usedPics = new Array(randomAmount + 1);\r\n\r\n        const generateNewPicID = () => {\r\n            let remailFailCounts = 5; // set max fail counts\r\n            let picNo;\r\n            while (remailFailCounts > 0) {\r\n                // rand one\r\n                picNo = Math.floor(Math.random() * randomAmount + 1);\r\n                if (!usedPics[picNo]) {\r\n                    // valid\r\n                    break;\r\n                } else {\r\n                    // fails\r\n                    remailFailCounts--;\r\n                }\r\n            }\r\n\r\n            if (remailFailCounts <= 0) {\r\n                // rand failed, find one manually\r\n                picNo = -1;\r\n                for (let i = 1; i <= randomAmount; i++) {\r\n                    if (!usedPics[i]) {\r\n                        // use first\r\n                        picNo = i;\r\n                        break;\r\n                    }\r\n                }\r\n                if (picNo === -1) {\r\n                    // All used\r\n                    // clear all\r\n                    for (let i = 1; i <= randomAmount; i++) {\r\n                        usedPics[i] = false;\r\n                    }\r\n                    // rand one\r\n                    picNo = Math.floor(Math.random() * randomAmount + 1);\r\n                }\r\n            }\r\n\r\n            // mark as used\r\n            usedPics[picNo] = true;\r\n            \r\n            // return\r\n            return picNo;\r\n        }\r\n\r\n        for (let i = 0, len = imageboxs.length; i < len; i++) {\r\n            if (!($(imageboxs[i]).attr(\"src\"))) {\r\n                const picNo = generateNewPicID();\r\n                const picFileName = picFileNameTemplate.replace(\"{no}\", picNo.toString());\r\n                $(imageboxs[i]).attr(\"src\", picFileName);\r\n            } \r\n        }\r\n    };\r\n\r\n    const initMathjax = ()=>{\r\n        if (typeof MathJax !== 'undefined') {\r\n            // 渲染Mathjax的初始化函数（用于处理ajax后的情况）\r\n            // 使用了同步处理的方式，可惜第一次加载页面时会双倍触发\r\n            // （MathJax载入时会自动初始化一次）\r\n            MathJax.Hub.Typeset();\r\n        }\r\n    };\r\n\r\n    const fancyboxInit = ()=>{\r\n          if (typeof $.fancybox !== 'undefined'){\r\n            $.fancybox.defaults.hash = false;\r\n            $('.kratos-hentry').each(function(i){\r\n                $(this).find('img').each(function(){\r\n                  if ($(this).parent().hasClass('fancybox') || $(this).parent().hasClass('qrcode') || $(this).parent().is('a')) return;\r\n                  const alt = this.alt;\r\n                  if (alt) $(this).after('<span class=\"caption\">' + alt + '</span>');\r\n                  $(this).wrap('<a rel=\"gallery\" href=\"' + this.src + '\" data-fancybox=\\\"gallery\\\" data-caption=\"' + alt + '\"></a>')\r\n                });\r\n            });\r\n            $('.fancybox').fancybox();\r\n          }\r\n    };\r\n\r\n    const tocNavInit = ()=>{\r\n        $(document).on(\"click\", 'a[class=toc-link]', function(){\r\n            $('html, body').animate({\r\n                scrollTop:$(decodeURI($(this).attr(\"href\"))).offset().top - 60\r\n            },500);\r\n            return false;\r\n        });\r\n    };\r\n\r\n    let copyrightString;\r\n    const setCopyright = ()=>{\r\n        copyrightString = `\r\n\r\n-------------------------\r\n${kr.copyrightNotice}\r\n作者：${document.querySelector(\"meta[name='author']\").getAttribute('content')}\r\n来源：${document.title}\r\n链接：${window.location.href}\r\n`;\r\n    }\r\n\r\n    const copyEventInit = ()=>{\r\n        if (kr.copyrightNotice) {\r\n            document.body.oncopy = (e)=>{\r\n                const copiedContent = window.getSelection().toString();\r\n                if (copiedContent.length > 150) {\r\n                    e.preventDefault();\r\n                    if (e.clipboardData) {\r\n                        e.clipboardData.setData(\"text/plain\", copiedContent + copyrightString);\r\n                    }\r\n                }\r\n            };\r\n        }\r\n    };\r\n\r\n    let docTitle = '';\r\n    const saveTitle = () => {\r\n        docTitle = document.title;\r\n    };\r\n\r\n    const leaveEventInit = () => {\r\n        if (kr.siteLeaveEvent) {\r\n            let titleTime;\r\n            const OriginLogo = $('[rel=\"icon\"]').attr(\"href\");\r\n            document.addEventListener('visibilitychange', ()=>{\r\n                if (document.hidden) {\r\n                    document.title = kr.leaveTitle;\r\n                    if (kr.leaveLogo) {\r\n                        $('[rel=\"icon\"]').attr(\"href\", kr.leaveLogo);\r\n                    }\r\n                    clearTimeout(titleTime);\r\n                } else {\r\n                    document.title = kr.returnTitle + \" \" + docTitle;\r\n                    if (kr.leaveLogo) {\r\n                        $('[rel=\"icon\"]').attr(\"href\", OriginLogo);\r\n                    }\r\n                    titleTime = setTimeout(()=>{\r\n                        document.title = docTitle;\r\n                        titleTime = 0;\r\n                    }, 2000);\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    const getTimeString = (msec, exact = true) => {\r\n        let tString;\r\n        const sec = msec / 1000;\r\n        const dnum = Math.floor(sec / 60 / 60 / 24);\r\n        const hnum = Math.floor(sec / 60 / 60 - (24 * dnum));\r\n        const mnum = Math.floor(sec / 60 - (24 * 60 * dnum) - (60 * hnum));\r\n        const snum = Math.floor(sec - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum));\r\n        let dstr = dnum.toString();\r\n        let hstr = hnum.toString();\r\n        let mstr = mnum.toString();\r\n        let sstr = snum.toString();\r\n        if (exact) {\r\n            if (dstr && dstr.length === 1) {\r\n                dstr = '0' + dstr;\r\n            }\r\n            if (hstr && hstr.length === 1) {\r\n                hstr = '0' + hstr;\r\n            }\r\n            if (mstr && mstr.length === 1) {\r\n                mstr = '0' + mstr;\r\n            }\r\n            if (sstr && sstr.length === 1) {\r\n                sstr = '0' + sstr;\r\n            }\r\n            tString = dstr + \"天\" + hstr + \"小时\" + mstr + \"分\" + sstr + \"秒\";\r\n        } else {\r\n            // 大概值\r\n            if (dnum < 540) {\r\n                // 一年半内\r\n                if (dnum < 60) {\r\n                    // 两个月内\r\n                    tString = dstr + \"天\";\r\n                } else {\r\n                    // 年内月外\r\n                    tString = Math.floor(dnum / 30).toString() + '个月';\r\n                }\r\n            } else {\r\n                // 年外\r\n                tString = Math.floor(dnum / 365).toString() + '年';\r\n            }\r\n        }\r\n        return tString;\r\n    };\r\n\r\n    const initTime = () => {\r\n        const createTime = new Date(kr.createTime);\r\n        const upTimeNode = document.getElementById(\"span_dt\");\r\n        setInterval(() => {\r\n            upTimeNode.innerText = getTimeString(Date.now() - createTime);\r\n        }, 1000);\r\n    };\r\n\r\n    const codeCopyInit = () => {\r\n        // 使用了clipboard.js，所以非常的简洁，只需在前端生成对应的按钮和指定代码框的ID即可\r\n        const codeFigures = document.querySelectorAll('figure.highlight');\r\n        codeFigures.forEach((figure, count) => {\r\n            figure\r\n                .getElementsByTagName('table')[0]\r\n                .getElementsByTagName('tbody')[0]\r\n                .getElementsByTagName('tr')[0]\r\n                .getElementsByClassName('code')[0]\r\n            .setAttribute('id', `code-${count}`);\r\n\r\n            figure.innerHTML += \r\n            `<button class=\"copy\" data-clipboard-target=\"#code-${count}\">\r\n                <i class=\"fa fa-copy\"></i>&nbsp;复制\r\n            </button>`;\r\n        });\r\n\r\n        const clipboard = new ClipboardJS('button.copy');\r\n\r\n        clipboard.on('success', (e) => {\r\n            const origInner = e.trigger.innerHTML;\r\n            e.trigger.innerHTML = `<i class=\"fa fa-check-circle\"></i>&nbsp;成功~`;\r\n            setTimeout(() => {\r\n                e.trigger.innerHTML = origInner;\r\n            }, 3000);\r\n\r\n            e.clearSelection();\r\n        });\r\n    };\r\n\r\n    const commentsLazyLoad = () => {\r\n        // 检查当前是否在浏览器中运行\r\n        const runningOnBrowser = typeof window !== \"undefined\";\r\n        // 通过检查 scroll 事件 API 和 User-Agent 来匹配爬虫\r\n        const isBot = runningOnBrowser && !(\"onscroll\" in window) || typeof navigator !== \"undefined\" && /(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent);\r\n        // 检查当前浏览器是否支持 IntersectionObserver API\r\n        const supportsIntersectionObserver = runningOnBrowser && \"IntersectionObserver\" in window;\r\n        // 需要懒加载的评论区块\r\n        const commsArea = document.querySelector('.post-comments.lazy-load');\r\n        // 加载评论的函数\r\n        const loadwork = () => {\r\n            if (window.loadCommentsEventHandler) {\r\n                // 取消上一个加载事件\r\n                window.cancelIdleCallback(window.loadCommentsEventHandler);\r\n            }\r\n            // 加载新评论模块\r\n            window.loadCommentsEventHandler = window.requestIdleCallback(load_comm);\r\n            // 防止二次加载，清理掉函数\r\n            load_comm = null;\r\n        };\r\n        if (runningOnBrowser && !isBot && supportsIntersectionObserver && commsArea !== null) {\r\n            const observer = new IntersectionObserver((entries) => {\r\n                if (entries[0].isIntersecting) {\r\n                    loadwork();\r\n                    observer.disconnect();\r\n                }\r\n            }, { threshold: 0 });\r\n            observer.observe(commsArea);\r\n        } else if (typeof load_comm !== 'undefined' && load_comm !== null) {\r\n            // 直接加载\r\n            loadwork();\r\n        }\r\n    };\r\n\r\n    const expireNotify = () => {\r\n        if (kr.expire_day) {\r\n            const expireAlert = document.getElementById('expire-alert');\r\n            if (expireAlert) {\r\n                const dateTimeTag = expireAlert.querySelector('time');\r\n                const updateDateTime = new Date(parseInt(dateTimeTag.getAttribute('datetime')));\r\n                const nowDateTime = Date.now();\r\n                const gap = nowDateTime - updateDateTime;\r\n                if (gap > kr.expire_day * 24 * 3600 * 1000) {\r\n                    // 内容可能过期，需要提示\r\n                    dateTimeTag.innerText = getTimeString(gap, false);\r\n                    expireAlert.classList.remove('hidden');\r\n                }\r\n            }\r\n            \r\n        }\r\n    };\r\n\r\n    const makeDelay = (callback, ms) => {\r\n        var timer = 0;\r\n        return function () {\r\n            var context = this, args = arguments;\r\n            clearTimeout(timer);\r\n            timer = setTimeout(function () {\r\n                callback.apply(context, args);\r\n            }, ms || 0);\r\n        };\r\n    }\r\n\r\n    const tocAnimInit = () => {\r\n        if (document.getElementById('krw-toc') !== null) {\r\n            // 有toc的页面\r\n            // 获取侧边栏所有的toc项\r\n            const tocDOMs = document.getElementById(\"krw-toc\").getElementsByClassName('toc-item');\r\n            // 元素高度映射记录\r\n            const tocItems = [];\r\n            try {\r\n                Array.from(tocDOMs).forEach((tocItem) => {\r\n                    const linkItem = tocItem.querySelector('.toc-link');\r\n                    const titleText = decodeURI(linkItem.getAttribute('href'));\r\n                    if (titleText.substring(0, 1) != '#') {\r\n                        throw new Error('TOC 小标题链接无效，格式无限');\r\n                    }\r\n                    const titleElem = document.getElementById(titleText.substring(1));\r\n                    if (!titleElem) {\r\n                        throw new Error('TOC 小标题链接无效，未找到相关引用');\r\n                    }\r\n                    titleElem.setAttribute(\"data-toc-id\", tocItems.length)\r\n                    tocItems.push({\r\n                        at: titleElem,\r\n                        el: tocItem\r\n                    });\r\n                });\r\n            } catch (e) {\r\n                console.log('错误：', e.message);\r\n                Array.from(tocDOMs).forEach((tocItem) => {\r\n                    tocItem.classList.add('show');\r\n                });\r\n                return;\r\n            }\r\n\r\n            // 初始化为不存在的标题\r\n            let curTocId = -1;\r\n            // 标题激活状态修改函数\r\n            const tocActivate = (newId) => {\r\n                if (curTocId === newId) {\r\n                    // Do nothing...\r\n                    return;\r\n                }\r\n                if (curTocId !== -1) {\r\n                    // 清除旧标题激活状态\r\n                    tocItems[curTocId].el.classList.remove('active');\r\n                    tocItems[curTocId].el.classList.remove('show');\r\n                    // 清除旧元素层级展示状态\r\n                    let nCur = tocItems[curTocId].el\r\n                    while (!nCur.classList.contains('toc')) {\r\n                        if (nCur.classList.contains('toc-item')) {\r\n                            nCur.classList.remove('show');\r\n                        }\r\n                        nCur = nCur.parentNode;\r\n                    }\r\n                }\r\n                if (newId !== -1) {\r\n                    // 构建新标题激活状态\r\n                    tocItems[newId].el.classList.add('active');\r\n                    tocItems[newId].el.classList.add('show');\r\n                    // 建立新元素层级展示状态\r\n                    let nCur = tocItems[newId].el\r\n                    while (!nCur.classList.contains('toc')) {\r\n                        if (nCur.classList.contains('toc-item')) {\r\n                            nCur.classList.add('show');\r\n                        }\r\n                        nCur = nCur.parentNode;\r\n                    }\r\n                }\r\n                curTocId = newId;\r\n            };\r\n\r\n            if (\"IntersectionObserver\" in window) {\r\n                const applyDecision = makeDelay((i, pos) => {\r\n                    if (pos === window.scrollY) {\r\n                        window.requestAnimationFrame(() => {\r\n                            tocActivate(i);\r\n                        });\r\n                    } else {\r\n                        applyDecision(i, window.scrollY);\r\n                    }\r\n                }, 100)\r\n\r\n                const observer = new IntersectionObserver((entries) => {\r\n                    let decision = null\r\n                    entries.forEach((entry) => {\r\n                        const currentIndex = Number.parseInt(entry.target.getAttribute('data-toc-id'), 10);\r\n                        if (!entry.isIntersecting\r\n                            && entry.boundingClientRect.top <= entry.rootBounds.top) {\r\n                            decision = currentIndex\r\n                        } else if (entry.isIntersecting\r\n                            && entry.boundingClientRect.bottom < entry.rootBounds.top + entry.rootBounds.height / 2\r\n                            && entry.intersectionRatio === 1) {\r\n                            decision = currentIndex - 1\r\n                        }\r\n                    })\r\n                    if (decision !== null) {\r\n                        applyDecision(decision, window.scrollY);\r\n                    }\r\n                }, {\r\n                    rootMargin: '-62px 0px 0px 0px',\r\n                    threshold: 1.0,\r\n                })\r\n                tocItems.forEach((x) => {\r\n                    observer.observe(x.at)\r\n                });\r\n                window.addEventListener('pjax:before', () => {\r\n                    observer.disconnect();\r\n                    tocItems.length = 0; // 奇妙的数组清空方式\r\n                }, { once: true });\r\n            } else {\r\n                const tocUpdatePos = () => {\r\n                    tocItems.forEach((x) => {\r\n                        x.h = x.at.getBoundingClientRect().top + window.scrollY - 61 // 比 click 事件那里多减掉1，避免浏览器 round 后导致的判断失败\r\n                    });\r\n                };\r\n\r\n                tocUpdatePos();\r\n\r\n                // 标题定位函数\r\n                const tocGetId = () => {\r\n                    let newPos;\r\n                    if (!Number.isInteger(curTocId) || curTocId < 0 || curTocId > tocItems.length - 1) {\r\n                        newPos = 0;\r\n                    } else {\r\n                        newPos = curTocId;\r\n                    }\r\n                    const nowY = window.scrollY;\r\n                    if (nowY >= tocItems[newPos].h) {\r\n                        if (nowY >= tocItems[tocItems.length - 1].h) {\r\n                            newPos = tocItems.length - 1;\r\n                        } else {\r\n                            while (nowY >= tocItems[newPos + 1].h) {\r\n                                newPos++;\r\n                            }\r\n                        }\r\n                    } else {\r\n                        while (nowY < tocItems[newPos].h) {\r\n                            newPos--;\r\n                            if (newPos < 0) break;\r\n                        }\r\n                    }\r\n                    return newPos;\r\n                }\r\n\r\n                // 处理事件的函数\r\n                const tocOnScroll = makeDelay(() => {\r\n                    window.requestAnimationFrame(() => {\r\n                        tocActivate(tocGetId());\r\n                    });\r\n                }, 100);\r\n\r\n                const tocOnResize = makeDelay(() => {\r\n                    tocUpdatePos();\r\n                    window.requestAnimationFrame(() => {\r\n                        tocActivate(tocGetId());\r\n                    });\r\n                }, 100);\r\n\r\n                window.addEventListener(\"resize\", tocOnResize);\r\n                window.addEventListener('scroll', tocOnScroll);\r\n                // pjax前销毁\r\n                window.addEventListener('pjax:before', () => {\r\n                    window.removeEventListener('resize', tocOnResize);\r\n                    window.removeEventListener('scroll', tocOnScroll);\r\n                    tocItems.length = 0; // 奇妙的数组清空方式\r\n                }, { once: true });\r\n            }\r\n\r\n            // 阅读进度\r\n            const readProgBar = document.getElementsByClassName('toc-progress-bar')[0];\r\n            const articleElem = document.querySelector('.kratos-post-content');\r\n            const setPercent = () => {\r\n                // 参考 Butterfly 主题相关实现\r\n                // https://github.com/jerryc127/hexo-theme-butterfly/blob/c1ac4a5e167f7bb26287fc9ca32a182cfc293231/source/js/main.js#L337-L346\r\n                if (articleElem) {\r\n                    const currentTop = window.scrollY || document.documentElement.scrollTop\r\n                    const docHeight = articleElem.clientHeight\r\n                    const winHeight = document.documentElement.clientHeight\r\n                    const headerHeight = articleElem.offsetTop\r\n                    const contentMath =\r\n                        (docHeight > winHeight) ?\r\n                            (docHeight - winHeight) :\r\n                            (document.documentElement.scrollHeight - winHeight)\r\n                    const scrollPercent = Math.max(0, Math.min((currentTop - headerHeight) / (contentMath), 1))\r\n                    const scrollPercentRound = Math.round(scrollPercent * 100)\r\n                    readProgBar.style.width = (scrollPercent * 100).toString() + '%';\r\n                    readProgBar.setAttribute('aria-valuenow', scrollPercentRound);\r\n                }\r\n            }\r\n            window.addEventListener('scroll', () => {\r\n                window.requestAnimationFrame(setPercent);\r\n            });\r\n            setPercent(); // 初始运行一次\r\n        }\r\n    };\r\n\r\n    const topNavScrollToggleInit = () => {\r\n        // 判断设置参数\r\n        if (!kr.topNavScrollToggle) {\r\n            return; // 没有启用\r\n        }\r\n        // 记录上一次滚动高度，用于判断滚动方向\r\n        let lastHeight = window.innerHeight;\r\n        // 记录顶部栏隐藏状态\r\n        let isTopNavHidden = false;\r\n\r\n        // 处理事件的函数\r\n        const handleTopNavScrollToggle = () => {\r\n            window.requestAnimationFrame(() => {\r\n                if (lastHeight < window.scrollY) {\r\n                    // 向下滚动\r\n                    if (!isTopNavHidden) {\r\n                        document.body.classList.add('nav-up');\r\n                        isTopNavHidden = true;\r\n                    }\r\n                } else if (lastHeight > window.scrollY) {\r\n                    // 向上滚动\r\n                    if (isTopNavHidden) {\r\n                        document.body.classList.remove('nav-up');\r\n                        isTopNavHidden = false;\r\n                    }\r\n                }\r\n                // 相等则不做处理\r\n                lastHeight = window.scrollY;\r\n            });\r\n        };\r\n\r\n        // 仅处理鼠标滚动\r\n        window.addEventListener('wheel', handleTopNavScrollToggle);\r\n\r\n    };\r\n\r\n    const pjaxReload = () => {\r\n        setrandpic();\r\n        fancyboxInit();\r\n        setCopyright();\r\n        saveTitle();\r\n        initMathjax();\r\n        codeCopyInit();\r\n        commentsLazyLoad();\r\n        expireNotify();\r\n        tocAnimInit();\r\n    };\r\n\r\n    const funcUsingConfig = () => {\r\n        // 因为涉及到配置文件，所以这些是只有在完成配置加载后才能调用的函数\r\n        pjaxReload();\r\n\r\n        copyEventInit();\r\n        leaveEventInit();\r\n        initTime();\r\n        donateConfig();\r\n        topNavScrollToggleInit();\r\n    };\r\n\r\n    window.addEventListener('pjax:complete', pjaxReload);\r\n\r\n    window.addEventListener('window:onload', () => {\r\n        loadConfig(funcUsingConfig);\r\n        pageScrollDownInit();\r\n        offcanvas();\r\n        mobiClick();\r\n        xControl();\r\n        shareMenu();\r\n        tocNavInit();\r\n    }, { once: true });\r\n\r\n    window.onload = () => {\r\n        window.dispatchEvent(new Event('window:onload'));\r\n        console.log('页面加载完毕！消耗了 %c'+Math.round(performance.now()*100)/100+' ms','background:#282c34;color:#51aded;');\r\n    };\r\n\r\n})();\r\n"]}